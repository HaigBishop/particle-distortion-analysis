#:kivy 2.2.0
# App: Particle Deformation Analysis
# Author: Haig Bishop

#:set LIGHT_GREY (128/255, 130/255, 158/255, 1)
#:set DARK_GREY (32/255, 33/255, 35/255, 1)
#:set GREY_BLUE (60/255, 77/255, 109/255, 1)
#:set BLUE_GREY_BLUE (75/255, 100/255, 153/255, 1)
#:set BLUE (96/255, 145/255, 246/255, 1)
#:set OFFWHITE (252/255, 252/255, 239/255, 1)
#:set GREY (62/255, 62/255, 59/255, 1)
#:set CLEAR (0, 0, 0, 0)
#:set WHITE (1,1,1,1)


# =========================================================================================

WindowManager:
    MainWindow:
    IE1Window:
    IE3Window:
    TD1Window:








# =========================================================================================
# +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# =========================================================================================

<MainWindow>:
    name: 'main'
    info_layout: info_layout
    main_grid: main_grid
    help_scroll: help_scroll
    # Main split
    GridLayout:
        id: main_grid
        rows: 2
        # Title / (i) split
        GridLayout:
            id: top_grid
            orientation: 'rl-tb'
            size_hint_y: None
            height: 140
            cols: 2
            FloatLayout:
                size_hint: None, None
                size: top_grid.height, top_grid.height
                # Info button
                Button:
                    background_color: 0, 0, 0, 0
                    background_normal: ''
                    background_down: ''
                    color: 1, 1, 1, 1
                    font_size: 30
                    text: '[b]i[/b]'
                    markup: True
                    size_hint_y: None
                    size_hint_x: None
                    pos: (top_grid.x + top_grid.width - self.width - 20, top_grid.y + top_grid.height - self.height - 20)
                    size: (50, 50)
                    on_press: root.toggle_info()
                    canvas.before:
                        Color:
                            rgba: main_grid.disabled and (98/255, 99/255, 101/255, 1) or (1, 1, 1, 1)
                        Line:
                            width: 1.5
                            circle:
                                (self.center_x, self.center_y, self.width/2, 0, 360)
            # Title / subtitle split
            GridLayout:
                rows: 2
                size_hint_y: 1
                size_hint_x: None
                width: main_grid.width - self.height
                FloatLayout:
                    size_hint_y: 0.6
                    size_hint_x: 1
                    # Title
                    Label:
                        id: title_label
                        text: 'Particle Deformation Analysis'
                        font_name: 'resources\\Inter.ttf'
                        font_size: 56
                        padding: [20, 0]
                        size_hint: None, None
                        size: self.texture_size
                        valign: 'bottom'
                        halign: 'left'
                        pos_hint: {'x': 0, 'y': 0}
                    # version
                    Label:
                        text: 'v0.1'
                        font_name: 'resources\\Inter.ttf'
                        font_size: 32
                        padding: [10, 0]
                        size_hint: None, None
                        size: self.texture_size
                        valign: 'bottom'
                        halign: 'left'
                        pos_hint: {'y': 0.1}
                        x: title_label.x + title_label.width
                # Subtitle
                Label:
                    text: ' Haig Bishop,  hbi34@uclive.ac.nz,  University of Canterbury'
                    font_name: 'resources\\Inter.ttf'
                    font_size: 18
                    padding: [20, 0]
                    size_hint_x: 1
                    size_hint_y: 0.35
                    halign: 'left'
                    valign: 'center'
                    text_size: self.size
        # Options / image split
        GridLayout:
            size_hint_y: 1
            cols: 3
            FloatLayout:
                size_hint_x: None
                width: 20
            # Options x 4
            GridLayout:
                rows: 4
                size_hint_x: 0.7
                # Button wrapper
                FloatLayout:
                    size_hint_y: 0.25
                    TangyButton:
                        id: btn_IE
                        font_name: 'resources\\Inter.ttf'
                        text: 'Import Experiments' # 'Images → Deformation'
                        font_size:48
                        size_hint: (1, 0.9)
                        pos_hint: {'right': 1, 'top':1}
                        on_release: 
                            app.root.current = 'IE1'
                            root.manager.transition.direction = 'left'
                FloatLayout:
                    size_hint_y: 0.25
                    TangyButton:
                        id: btn_ps
                        font_name: 'resources\\Inter.ttf'
                        font_size:48
                        text: 'Track Particle Deformation' # '...'
                        size_hint: (1, 0.9)
                        pos_hint: {'right': 1, 'top':1}
                        on_release: 
                            app.root.current = 'TD1'
                            root.manager.transition.direction = 'left'
                FloatLayout:
                    size_hint_y: 0.25
                    TangyButton:
                        id: btn_pf
                        font_name: 'resources\\Inter.ttf'
                        text: 'Fit Deformation/Current Models' # 'Deformation → Force'
                        font_size:48
                        size_hint: (1, 0.9)
                        pos_hint: {'right': 1, 'top':1}
                FloatLayout:
                    size_hint_y: 0.25
                    TangyButton:
                        id: btn_fg
                        font_name: 'resources\\Inter.ttf'
                        font_size:48
                        text: 'Predict Physical Properties' # 'Force → Plots'
                        size_hint: (1, 0.9)
                        pos_hint: {'right': 1, 'top':1}
            # Image container
            FloatLayout:
                size_hint_x: 0.3
                Image:
                    size_hint: (0.9, 0.975)
                    pos_hint: {'center_x':0.5, 'top':1}
                    fit_mode: 'cover'
                    source: 'resources\\example_image.png'
    # Whole screen float for the info screen
    FloatLayout:
        id: info_layout
        disabled: True
        opacity: 0 if self.disabled else 1
        pos: (99999, 99999)
        Button:
            background_color: 0, 0, 0, 0
            pos_hint: {'center_x':0.5, 'center_y':0.5}
            size_hint: 1, 1
            on_press: root.toggle_info()
        FloatLayout:
            id: info_sublayout
            pos_hint: {'center_x':0.5, 'center_y':0.5}
            size_hint: 0.9, 0.9
            canvas.before:
                Color:
                    rgba: DARK_GREY
                Rectangle:
                    pos: self.pos
                    size: self.size
                Color:
                    rgba: WHITE
                Line:
                    width: 1.
                    rectangle: (self.x, self.y, self.width, self.height)
            ScrollView:
                id: help_scroll
                pos: (info_sublayout.x + 18, info_sublayout.y)
                size_hint: None, None
                size: (info_sublayout.width - 18, info_sublayout.height - 12)
                bar_pos_y: 'right'
                do_scroll_x: False
                do_scroll_y: True
                GridLayout:
                    id: grid
                    size_hint: None, None
                    width: help_scroll.width
                    height: max(self.minimum_height, help_scroll.height)
                    cols: 1
                    spacing: 5
                    Label:
                        size_hint: None, None
                        size: self.texture_size
                        text: root.info_text
                        color: WHITE
                        padding: [30, 30]
                        markup: True
                        font_name: 'resources\\Inter.ttf'
                        font_size: 24






# =========================================================================================
# +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# =========================================================================================

<IE1Window>:
    name: 'IE1'
    id: ie1_window
    exp_scroll: exp_scroll
    select_vid_btn: select_vid_btn
    location_label: location_label
    ion_location_label: ion_location_label
    param_grid_layout: param_grid_layout
    name_grid_layout: name_grid_layout
    name_input: name_input
    image_widget: image_widget
    GridLayout:
        canvas:
            Color:
                rgba: 1,1,1,0.1
            Line:
                points: [0, self.height - 60, self.width, self.height - 60]
                width: 0.5
            Line:
                points: [self.width*0.75, self.height, self.width*0.75, 0]
                width: 0.5
            Color:
                rgba: (42/255, 42/255, 45/255, 1)
            Rectangle:
                pos: (0,0)
                size: (self.width*0.75, (self.height-80) * 0.79)
            Color:
                rgba: GREY
            Line:
                points: [self.width*0.36, (self.height-80) * 0.79, self.width*0.36, 0]
                width: 0.5
        cols: 3
        GridLayout:
            rows: 2
            size_hint_x: 0.74
            GridLayout:
                cols: 3
                size_hint_y: None
                height: 60
                BlankButton:
                    text:'←'
                    font_name: 'resources\\Inter.ttf'
                    font_size: 52
                    padding: [0, 20]
                    size_hint_x: None
                    width: 120
                    on_release: 
                        root.on_back_btn()
                Label:
                    font_name: 'resources\\Inter.ttf'
                    text: 'Import Experiments'
                    font_size: 30
                    padding: [5, 3]
                    size_hint_x: None
                    width: 700
                    halign: 'left'
                    valign: 'center'
                    text_size: self.size
                FloatLayout:
                    size_hint_x: 1
            GridLayout:
                rows: 2
                size_hint_y: 1
                FloatLayout:
                    size_hint_y: 0.2
                    TangyButton:
                        id: select_vid_btn
                        size_hint:(None,None)
                        font_name: 'resources\\Inter.ttf'
                        size: (160,50)
                        font_size: 18
                        pos_hint: {'x':.095, 'y':.3}
                        text:'select video(s)'
                        on_release: root.schedule_with_load(root.select_vid_files)
                    Label:
                        id: location_label
                        color: WHITE
                        size_hint:(None,None)
                        size: (self.parent.width * 0.8, 40)
                        pos_hint: {'x':.1, 'y':0.06}
                        text: 'No file(s) selected'
                        halign: 'left'
                        font_name: 'resources\\Inter.ttf'
                        text_size: self.size
                        shorten: True
                        font_size: 16
                    GridLayout:
                        id: name_grid_layout
                        disabled: app.current_experiment is None
                        cols: 2
                        size_hint:(.69, 1)
                        pos_hint: {'x':.30, 'y':0}
                        Label:
                            text: 'Experiment Name:'
                            color: WHITE
                            font_name: 'resources\\Inter.ttf'
                            font_size: 22
                            size_hint_x: 0.35
                        FloatLayout:
                            size_hint_x: 0.6
                            TextInput:
                                id: name_input
                                on_text: root.on_name_text(self.text)
                                size_hint_x: 1
                                size_hint_y: None
                                pos_hint: {'x':0, 'center_y':.5}
                                height: 40
                                multiline: False
                                text_align: 'justify'
                GridLayout:
                    id: param_grid_layout
                    disabled: app.current_experiment is None
                    cols: 2
                    size_hint_y: 0.8
                    FloatLayout:
                        id: ion_select_layout
                        size_hint_x: 0.5
                        rows: 2
                        TangyButton:
                            id: ion_select_btn
                            size_hint:(None,None)
                            size: (200, 50)
                            disabled_color: DARK_GREY
                            font_size: 18
                            pos_hint: {'x':.06, 'y':.83}
                            text:'select ion current file'
                            on_release: root.schedule_with_load(root.select_ion_file)
                            font_name: 'resources\\Inter.ttf'
                        Button:
                            text: '×'
                            font_size: 32
                            background_color: CLEAR
                            background_normal: ''
                            color: WHITE
                            disabled: True if ion_location_label.text == 'No file selected' else False
                            size_hint: (None, None)
                            size: (30, 30)
                            pos_hint: {'x':.052, 'y':.762}
                            on_press: root.on_ion_x_btn()
                        Label:
                            id: ion_location_label
                            color: WHITE
                            size_hint:(None,None)
                            size: (ion_select_layout.width * 0.82,50)
                            pos_hint: {'x':.13, 'y':0.77}
                            text: 'No file selected'
                            halign: 'left'
                            font_name: 'resources\\Inter.ttf'
                            text_size: self.size
                            shorten: True
                            font_size: 16
                    GridLayout:
                        size_hint_x: 0.5
                        rows: 2
                        Label:
                            font_name: 'resources\\Inter.ttf'
                            text: 'Video Preview'
                            font_size: 32
                            size_hint: (1, 0.2)
                        Image:
                            id: image_widget
                            size_hint: (1, 0.8)
                            fit_mode: 'contain'
                            color: CLEAR if self.texture is None else WHITE
        FloatLayout:
            size_hint_x: 0.02
        GridLayout:
            id: right_grid
            rows: 6
            size_hint_x: 0.24
            Label:
                text:'Experiments'
                size_hint_y: None
                padding: [0, 45]
                font_name: 'resources\\Inter.ttf'
                color: WHITE
                font_size: 28
                height: 60
                valign: 'center'
            ExperimentList:
                id: exp_scroll
                window: ie1_window
                size_hint:(None,None)
                height: right_grid.height - 180
                width: right_grid.width-6
                bar_pos_y: 'right'
                do_scroll_x: False
                do_scroll_y: True
            FloatLayout:
                size_hint:(None,None)
                size: (right_grid.width-6, 6)
            TangyButton:
                disabled:  len(root.exp_scroll.grid_layout.children) == 0 or not root.ion_files_attached
                disabled_color: DARK_GREY
                text: 'Proceed With Current Data'
                size_hint:(None,None)
                font_size: 22
                font_name: 'resources\\Inter.ttf'
                size: (right_grid.width-6, 50)
                on_release: root.on_proceed(with_ion=True)
            FloatLayout:
                size_hint:(None,None)
                size: (right_grid.width-6, 6)
            TangyButton:
                disabled:  len(root.exp_scroll.grid_layout.children) == 0
                disabled_color: DARK_GREY
                text: 'Proceed Without Current Data'
                size_hint:(None,None)
                font_size: 16
                font_name: 'resources\\Inter.ttf'
                size: (right_grid.width-6, 50)
                on_release: root.on_proceed(with_ion=False)
    LoadingScreen:
        disabled: not root.is_loading
        x: 0 if root.is_loading else 69420







# =========================================================================================
# +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# =========================================================================================





<IE3Window>:
    name: 'IE3'
    id: ie3_window
    exp_scroll: exp_scroll
    location_label: location_label
    ion_location_label: ion_location_label
    video_widget: video_widget
    video_slider: video_slider
    frame_label: frame_label
    ion_view: ion_view
    GridLayout:
        canvas:
            Color:
                rgba: 1,1,1,0.1
            Line:
                points: [0, self.height - 60, self.width, self.height - 60]
                width: 0.5
            Line:
                points: [self.width*0.75, self.height, self.width*0.75, 0]
                width: 0.5
            Color:
                rgba: (42/255, 42/255, 45/255, 1)
            Rectangle:
                pos: (0,0)
                size: (self.width*0.75, self.height-60)
        cols: 3
        GridLayout:
            rows: 2
            size_hint_x: 0.74
            GridLayout:
                cols: 3
                size_hint_y: None
                height: 60
                BlankButton:
                    text:'←'
                    font_name: 'resources\\Inter.ttf'
                    font_size: 52
                    padding: [0, 20]
                    size_hint_x: None
                    width: 120
                    on_release: 
                        root.on_back_btn()
                Label:
                    font_name: 'resources\\Inter.ttf'
                    text: 'Select Events'
                    font_size: 30
                    padding: [5, 3]
                    size_hint_x: None
                    width: 700
                    halign: 'left'
                    valign: 'center'
                    text_size: self.size
                FloatLayout:
                    size_hint_x: 1
            GridLayout:
                rows: 4
                size_hint_y: 1
                # Buttons row
                GridLayout:
                    cols: 5
                    size_hint_y: 0.1
                    BlankButton:
                        text:'←'
                        font_name: 'resources\\Inter.ttf'
                        font_size: 22
                        padding: [0, 20]
                        size_hint_x: None
                        width: self.height
                    BlankButton:
                        text:'+'
                        font_name: 'resources\\Inter.ttf'
                        font_size: 22
                        padding: [0, 20]
                        size_hint_x: None
                        width: self.height
                    BlankButton:
                        text:'−'
                        font_name: 'resources\\Inter.ttf'
                        font_size: 22
                        padding: [0, 20]
                        size_hint_x: None
                        width: self.height
                    BlankButton:
                        text:'→'
                        font_name: 'resources\\Inter.ttf'
                        font_size: 22
                        padding: [0, 20]
                        size_hint_x: None
                        width: self.height
                    Label:
                        id: ion_location_label
                        color: WHITE
                        size_hint_x: 1
                        text: 'No file(s) selected'
                        padding: [20, 0, 0, 10]
                        halign: 'left'
                        font_name: 'resources\\Inter.ttf'
                        text_size: self.size
                        shorten: True
                        font_size: 16
                GridLayout:
                    id: image_row
                    size_hint_y: 0.2
                    cols: 3
                    FloatLayout:
                        size_hint: None, 1
                        width: 24
                    # Ion current view
                    IonCurrentView:
                        id: ion_view
                        ie3_window: ie3_window
                        video_slider: video_slider
                        size_hint: None, 1
                        width: image_row.width - 48
                    FloatLayout:
                        size_hint: None, 1
                        width: 24
                # Slider
                Slider:
                    id: video_slider
                    min: 0
                    max: 1
                    size_hint: 1, 0.1
                    cursor_image: 'resources\\white_circle.png'
                    cursor_size: 36, 36
                    on_value: root.on_slider()
                # Side buttons and video view
                GridLayout:
                    cols: 4
                    size_hint_y: 0.6
                    FloatLayout:
                        size_hint:(None,1)
                        width: 12
                    # Side Buttons
                    GridLayout:
                        size_hint_x: 0.3
                        rows: 6
                        TangyButton:
                            disabled: not root.ready_for_start
                            disabled_color: DARK_GREY
                            text: 'Enter Start'
                            size_hint:(None,None)
                            font_size: 16
                            font_name: 'resources\\Inter.ttf'
                            size_hint: 1, 0.25
                            on_press: root.add_start_here()
                        FloatLayout:
                            size_hint:(1,None)
                            height: 6
                        TangyButton:
                            disabled: root.ready_for_start
                            disabled_color: DARK_GREY
                            text: 'Enter Stop'
                            size_hint:(None,None)
                            font_size: 16
                            font_name: 'resources\\Inter.ttf'
                            size_hint: 1, 0.25
                            on_press: root.add_stop_here()
                        FloatLayout:
                            size_hint:(1,None)
                            height: 6
                        TangyButton:
                            disabled: not root.slider_on_event
                            disabled_color: DARK_GREY
                            text: 'Remove'
                            size_hint:(None,None)
                            font_size: 16
                            font_name: 'resources\\Inter.ttf'
                            size_hint: 1, 0.25
                            on_press: root.remove_here()
                        FloatLayout:
                            size_hint:(1,1)
                            Label:
                                id: frame_label
                                color: WHITE
                                size_hint: (1, None)
                                height: 40
                                padding: [20, 0, 0, 10]
                                halign: 'left'
                                font_name: 'resources\\Inter.ttf'
                                text_size: self.size
                                shorten: True
                                font_size: 20

                    FloatLayout:
                        size_hint:(None,1)
                        width: 12
                    # Video View & File Location Label
                    GridLayout:
                        size_hint_x: 0.7
                        rows: 2
                        Image:
                            id: video_widget
                            size_hint: (1, 0.9)
                            fit_mode: 'contain'
                            color: CLEAR if self.texture is None else WHITE
                        Label:
                            id: location_label
                            color: WHITE
                            size_hint: (1, 0.1)
                            text: 'No file(s) selected'
                            padding: [20, 0, 0, 10]
                            halign: 'left'
                            font_name: 'resources\\Inter.ttf'
                            text_size: self.size
                            shorten: True
                            font_size: 16
        FloatLayout:
            size_hint_x: 0.02
        GridLayout:
            id: right_grid
            rows: 6
            size_hint_x: 0.24
            Label:
                text:'Experiments'
                size_hint_y: None
                padding: [0, 45]
                font_name: 'resources\\Inter.ttf'
                color: WHITE
                font_size: 28
                height: 60
                valign: 'center'
            ExperimentList:
                id: exp_scroll
                window: ie3_window
                size_hint:(None,None)
                height: right_grid.height - 124
                width: right_grid.width-6
                bar_pos_y: 'right'
                do_scroll_x: False
                do_scroll_y: True
            FloatLayout:
                size_hint:(None,None)
                size: (right_grid.width-6, 6)
            TangyButton:
                disabled:  len(root.exp_scroll.grid_layout.children) == 0
                disabled_color: DARK_GREY
                text: 'Proceed'
                size_hint:(None,None)
                font_size: 16
                font_name: 'resources\\Inter.ttf'
                size: (right_grid.width-6, 50)
                on_release: root.on_proceed()






# =========================================================================================
# +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# =========================================================================================

<TD1Window>:
    name: 'TD1'
    id: td1_window
    evt_scroll: evt_scroll
    select_event_btn: select_event_btn
    location_label: location_label
    param_grid_layout: param_grid_layout
    name_grid_layout: name_grid_layout
    name_input: name_input
    image_widget: image_widget
    GridLayout:
        canvas:
            Color:
                rgba: 1,1,1,0.1
            Line:
                points: [0, self.height - 60, self.width, self.height - 60]
                width: 0.5
            Line:
                points: [self.width*0.75, self.height, self.width*0.75, 0]
                width: 0.5
            Color:
                rgba: (42/255, 42/255, 45/255, 1)
            Rectangle:
                pos: (0,0)
                size: (self.width*0.75, (self.height-80) * 0.79)
        cols: 3
        GridLayout:
            rows: 2
            size_hint_x: 0.74
            GridLayout:
                cols: 3
                size_hint_y: None
                height: 60
                BlankButton:
                    text:'←'
                    font_name: 'resources\\Inter.ttf'
                    font_size: 52
                    padding: [0, 20]
                    size_hint_x: None
                    width: 120
                    on_release: 
                        root.on_back_btn()
                Label:
                    font_name: 'resources\\Inter.ttf'
                    text: 'Track Deformation'
                    font_size: 30
                    padding: [5, 3]
                    size_hint_x: None
                    width: 700
                    halign: 'left'
                    valign: 'center'
                    text_size: self.size
                FloatLayout:
                    size_hint_x: 1
            GridLayout:
                rows: 2
                size_hint_y: 1
                FloatLayout:
                    size_hint_y: 0.2
                    TangyButton:
                        id: select_event_btn
                        size_hint:(None,None)
                        font_name: 'resources\\Inter.ttf'
                        size: (160,50)
                        font_size: 18
                        pos_hint: {'x':.095, 'y':.3}
                        text:'select event(s)'
                        on_release: root.select_event_files()
                    Label:
                        id: location_label
                        color: WHITE
                        size_hint:(None,None)
                        size: (self.parent.width * 0.8, 40)
                        pos_hint: {'x':.1, 'y':0.06}
                        text: 'No file(s) selected'
                        halign: 'left'
                        font_name: 'resources\\Inter.ttf'
                        text_size: self.size
                        shorten: True
                        font_size: 16
                    GridLayout:
                        id: name_grid_layout
                        disabled: app.current_event is None
                        cols: 2
                        size_hint:(.69, 1)
                        pos_hint: {'x':.30, 'y':0}
                        Label:
                            text: 'Event Name:'
                            color: WHITE
                            font_name: 'resources\\Inter.ttf'
                            font_size: 22
                            size_hint_x: 0.35
                        FloatLayout:
                            size_hint_x: 0.6
                            TextInput:
                                id: name_input
                                on_text: root.on_name_text(self.text)
                                size_hint_x: 1
                                size_hint_y: None
                                pos_hint: {'x':0, 'center_y':.5}
                                height: 40
                                multiline: False
                                text_align: 'justify'
                GridLayout:
                    id: param_grid_layout
                    disabled: app.current_event is None
                    cols: 1
                    size_hint_y: 0.8
                    GridLayout:
                        size_hint_x: 1
                        rows: 2
                        Label:
                            font_name: 'resources\\Inter.ttf'
                            text: 'Video Preview'
                            font_size: 32
                            size_hint: (1, 0.2)
                        Image:
                            id: image_widget
                            size_hint: (1, 0.8)
                            fit_mode: 'contain'
                            color: CLEAR if self.texture is None else WHITE
        FloatLayout:
            size_hint_x: 0.02
        GridLayout:
            id: right_grid
            rows: 4
            size_hint_x: 0.24
            Label:
                text:'Events'
                size_hint_y: None
                padding: [0, 45]
                font_name: 'resources\\Inter.ttf'
                color: WHITE
                font_size: 28
                height: 60
                valign: 'center'
            ExperimentList:
                id: evt_scroll
                window: td1_window
                size_hint:(None,None)
                height: right_grid.height - 124
                width: right_grid.width-6
                bar_pos_y: 'right'
                do_scroll_x: False
                do_scroll_y: True
            FloatLayout:
                size_hint:(None,None)
                size: (right_grid.width-6, 6)
            TangyButton:
                disabled:  len(root.evt_scroll.grid_layout.children) == 0
                disabled_color: DARK_GREY
                text: 'Track Deformation'
                size_hint:(None,None)
                font_size: 20
                font_name: 'resources\\Inter.ttf'
                size: (right_grid.width-6, 50)
                on_release: root.on_track()










# =========================================================================================





<BackPopup>:
    size_hint: 0.6, 0.4
    title: 'Return to Main Menu and lose all progress' if self.screen_id == 'main' else 'Return to previous screen and lose progress here'
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: 'Are you sure?'
        BoxLayout:
            size_hint_y: None
            height: dp(40)
            Button:
                text: 'Yes'
                on_release: root.on_answer('yes')
            Button:
                text: 'No'
                on_release: root.on_answer('no')




# =========================================================================================

<ErrorPopup>:
    error_label: error_label
    size_hint: 0.6, 0.4
    auto_dismiss: False
    title: 'Invalid Data'
    BoxLayout:
        orientation: 'vertical'
        Label:
            id: error_label
        BoxLayout:
            size_hint_y: None
            height: dp(40)
            Button:
                text: 'Okay'
                on_release: root.on_answer('ok')



# =========================================================================================

<TangyButton@Button>:
    background_normal: ''
    background_color: CLEAR
    background_down: ''
    border: CLEAR
    color: DARK_GREY
    canvas.before:
        Color:
            rgba: (self.state == 'normal' and self.disabled == False) and OFFWHITE or GREY
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [10,]


# =========================================================================================

<BlankButton@Button>:
    background_normal: ''
    background_color: CLEAR
    background_down: ''
    border: CLEAR
    color: OFFWHITE
    canvas.before:
        Color:
            rgba: (self.state == 'normal') and CLEAR or GREY
        RoundedRectangle:
            pos: self.x+2, self.y+2
            size: self.width-4, self.height-4
            radius: [14,]





# =========================================================================================

<ExperimentList>:
    size_hint: (1, 1)
    grid_layout: grid
    GridLayout:
        id: grid
        size_hint_y: None
        height: max(self.minimum_height,root.height)
        cols: 1
        spacing: 5

        
# =========================================================================================

<ExperimentBox>:
    size_hint_x: 1
    size_hint_y: None
    height: 100
    name: 'temp'
    date: None
    file_location: None
    background_normal: ''
    background_normal: ''
    background_color: CLEAR
    background_down: ''
    border: CLEAR
    font_name: 'resources\\Inter.ttf'
    canvas.before:
        Color:
            rgba: self.is_selected and OFFWHITE or GREY
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [12,]
    Label:
        text: 'Name:  ' + str(root.experiment.name)
        color: WHITE
        size_hint: (None, None)
        size: (root.width - 50, 30)
        pos: (root.x + 5, root.y + 70)
        halign: 'left'
        color: DARK_GREY
        text_size: self.size
        shorten: True
    Label:
        text: 'File:  ' + str(root.experiment.vid_loc).split('\\')[-1].split('/')[-1]
        color: WHITE
        size_hint: (None, None)
        size: (root.width, 35)
        pos: (root.x + 5, root.y + 40)
        halign: 'left'
        color: DARK_GREY
        text_size: self.size
        shorten: True
    Label:
        text: 'Date:  ' + str(root.experiment.vid_date)
        color: WHITE
        size_hint: (None, None)
        size: (root.width, 30)
        pos: (root.x + 5, root.y + 10)
        halign: 'left'
        color: DARK_GREY
        text_size: self.size
        shorten: True
    Button:
        text: '×'
        font_size: 24
        background_color: CLEAR
        background_normal: ''
        color: DARK_GREY
        size_hint: (None, None)
        size: (30, 30)
        pos: (root.x + root.width - 30, root.y + root.height - 30)
        on_press: root.parent.parent.on_x_btn(root, root.window.name)
    Button:
        background_color: CLEAR
        size_hint: (None, None)
        size: (20, 30)
        pos: (root.x + root.width - 50, root.y + root.height - 30)
        on_press: root.on_open_btn()
        Image:
            source: 'resources\\open_btn.png'
            y: self.parent.y + 5
            x: self.parent.x
            size: (20, 20)





# =========================================================================================

<EventList>:
    size_hint: (1, 1)
    grid_layout: grid
    GridLayout:
        id: grid
        size_hint_y: None
        height: max(self.minimum_height,root.height)
        cols: 1
        spacing: 5

        
# =========================================================================================

<EventBox>:
    size_hint_x: 1
    size_hint_y: None
    height: 100
    name: 'temp'
    date: None
    file_location: None
    background_normal: ''
    background_normal: ''
    background_color: CLEAR
    background_down: ''
    border: CLEAR
    font_name: 'resources\\Inter.ttf'
    canvas.before:
        Color:
            rgba: self.is_selected and OFFWHITE or GREY
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [12,]
    Label:
        text: 'Name:  ' + str(root.experiment.name)
        color: WHITE
        size_hint: (None, None)
        size: (root.width - 50, 30)
        pos: (root.x + 5, root.y + 70)
        halign: 'left'
        color: DARK_GREY
        text_size: self.size
        shorten: True
    Label:
        text: 'File:  ' + str(root.experiment.vid_loc).split('\\')[-1].split('/')[-1]
        color: WHITE
        size_hint: (None, None)
        size: (root.width, 35)
        pos: (root.x + 5, root.y + 40)
        halign: 'left'
        color: DARK_GREY
        text_size: self.size
        shorten: True
    Label:
        text: 'Date:  ' + str(root.experiment.vid_date)
        color: WHITE
        size_hint: (None, None)
        size: (root.width, 30)
        pos: (root.x + 5, root.y + 10)
        halign: 'left'
        color: DARK_GREY
        text_size: self.size
        shorten: True
    Button:
        text: '×'
        font_size: 24
        background_color: CLEAR
        background_normal: ''
        color: DARK_GREY
        size_hint: (None, None)
        size: (30, 30)
        pos: (root.x + root.width - 30, root.y + root.height - 30)
        on_press: root.parent.parent.on_x_btn(root, root.window.name)
    Button:
        background_color: CLEAR
        size_hint: (None, None)
        size: (20, 30)
        pos: (root.x + root.width - 50, root.y + root.height - 30)
        on_press: root.on_open_btn()
        Image:
            source: 'resources\\open_btn.png'
            y: self.parent.y + 5
            x: self.parent.x
            size: (20, 20)




# =========================================================================================


<IonCurrentView>:
    size_hint: 1, 1
    color: WHITE if self.texture is None else WHITE
    on_touch_down: root.set_frame(args[1].pos)
    on_touch_move: root.set_frame(args[1].pos)



# =========================================================================================
<LoadingScreen@FloatLayout>:
    size_hint: (1, 1)
    pos_hint: {'center_y': 0.5}
    canvas.before:
        Color:
            rgba: 0, 0, 0, 0.4  # Grey color with 50% opacity
        Rectangle:
            pos: self.pos
            size: self.size
    Label:
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        size_hint: (0.2, 0.2)
        text: 'Loading...'
        font_size: 38
        font_name: 'resources\\Inter.ttf'
